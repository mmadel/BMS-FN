<ngx-spinner></ngx-spinner>
<ng-container *ngIf="props$ | async as props" fluid="true">
  <c-smart-table [columnSorter]="{resetable: true }" [columns]="columns" [items]="(patientSessions$ | async) ?? []"
    [itemsPerPage]="props.itemsPerPage" (itemsPerPageChange)="handleItemsPerPageChange($event)"
    [itemsPerPageOptions]="[5,10,20,25,30,40,45,50]" [itemsPerPageSelect]="true"
    [tableProps]="{ hover: true, striped: true, small:true }" [columnFilterValue]="props.columnFilterValue?? []"
    [sorterValue]="props.sorterValue" [tableBodyProps]="{ align: 'middle' }"
    (sorterValueChange)="handleSorterValueChange($event)" header>
    <ng-template cTemplateId="tableData" let-columnName="columnName" let-item="item" let-tdContent="tdContent">
      <td>
        <ng-container [ngSwitch]="columnName">
          <ng-container *ngSwitchCase="'dateOfService'" class="py-2">
            {{tdContent| date:'MMM d, y, h:mm a'}}
          </ng-container>
          <ng-container *ngSwitchCase="'actions'" class="py-2">
            <div class="btn-group" role="group" aria-label="Basic example">
              <button cButton variant="outline" size="sm" (click)="openEditPateintSession(item)">
                <svg cIcon name="cilPen"></svg>
              </button>
              <button cButton variant="outline" size="sm" (click)="enterPayment(item)" dispaly-input
                cTooltip="enter payment" [childRole]="enterPaymentRole">
                <svg cIcon name="cilDollar"></svg>
              </button>
              <button cButton variant="outline" size="sm" (click)="correctClaim(item)" cTooltip="correct calim"
                [disabled]="item.data.isCorrectSession" dispaly-input [childRole]="correctClaimRole">
                <svg cIcon name="cilPaperclip"></svg>
              </button>
            </div>
          </ng-container>
          <ng-container *ngSwitchDefault>
            {{tdContent}}
          </ng-container>

          <ng-container *ngSwitchCase="'correct'">
            <span *ngIf="item.data.isCorrectSession">
              <c-badge color="warning">
                corrected
              </c-badge>
            </span>
          </ng-container>
        </ng-container>
      </td>
    </ng-template>
  </c-smart-table>
  <c-smart-pagination *ngIf="props.totalPages" [activePage]="props.activePage"
    (activePageChange)="handleActivePageChange($event)" [pages]="props.totalPages"></c-smart-pagination>
</ng-container>

<c-modal id="editSession" [visible]="editSessionVisibility" backdrop="static" size="xl">
  <c-modal-header>
    <h2 cModalTitle>Edit Session</h2>
    <button (click)="toggleEditSession(null)" cButtonClose></button>
  </c-modal-header>
  <c-modal-body>
    <app-patient-session-edit #patientSessionEditComponent *ngIf="editSessionVisibility"
      (changeVisibility)="changeVisibility($event)"></app-patient-session-edit>
  </c-modal-body>
</c-modal>
<c-modal id="correctRedirectConfiramtion" [visible]="correctRedirectConfiramtionVisibility" size="lg">
  <c-modal-header>
    <h5 cModalTitle>Correct Claim Redirection</h5>
    <button (click)="toggleCorrectRedirectConfiramtion()" cButtonClose></button>
  </c-modal-header>
  <c-card-body>
    <p class="lead">To view session invoices, please click 'OK' to proceed to the invoice area</p>
  </c-card-body>
  <c-card-header>
    <div class="col-12 text-center">
      <button cButton variant="outline" style="width: 10%;" class="mx-3"
        (click)="redirectConfirmation(true)">Ok</button>
      <button cButton variant="outline" style="width:10%;" (click)="redirectConfirmation(false)">Cancel </button>
    </div>
  </c-card-header>
</c-modal>
<c-modal id="enterPayment" [visible]="enterPaymentVisibility" size="xl" backdrop="static">
  <c-modal-header>
    <h2 cModalTitle>Enter Payment</h2>
    <button (click)="toggleEnterPaymnet()" cButtonClose></button>
  </c-modal-header>
  <c-modal-body>
    <enter-payment *ngIf="enterPaymentVisibility" [session]="selectedPatientSession"
      [insuranceCompanies]="insuranceCompanies"
      (changeVisibility)="changeEnterPaymentVisibility($event)"></enter-payment>
  </c-modal-body>
</c-modal>