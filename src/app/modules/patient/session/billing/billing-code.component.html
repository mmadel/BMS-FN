<c-container [fluid]="true">
    <c-card class="mb-3">
        <c-card-header>
            <h5>Billing And Coding</h5>
        </c-card-header>
        <c-card-body>
            <div class="mb-3">
                <c-row class="mb-1">
                    <c-col>
                        <select cSelect sizing="sm" [(ngModel)]="billingCode.placeOfCode">
                            <option [value]=null selected disabled>Select Place Code</option>
                            <option *ngFor="let placeOfCodevalue of placeOfCodeKeys(placeOfCodes)"
                                [ngValue]="placeOfCodevalue">
                                {{placeOfCodes[placeOfCodevalue]}}
                            </option>
                        </select>
                    </c-col>
                </c-row>
                <c-row class="mb-1">
                    <c-col>
                        <select cSelect sizing="sm" [(ngModel)]="billingCode.facility">
                            <option [value]=null selected disabled>Select Facility</option>
                            <option [value]="'clinic-a'">clinic-a</option>
                            <option [value]="'clinic-b'">clinic-b</option>
                        </select>
                    </c-col>
                </c-row>
                <c-row class="mb-1">
                    <c-col>
                        <input cFormControl name="icd10diagnosis" [formControl]="diagnosisCtrl"
                            placeholder="Type ICD-10 Code" sizing="sm" />
                    </c-col>
                </c-row>
                <c-row>
                    <span align="center" *ngIf="isLoading">
                        <c-spinner variant="grow"></c-spinner>
                    </span>
                    <span *ngIf="!isLoading">
                        <c-col>
                            <select cSelect class="mb-2" (valueChange)="addICD10diagnosis($event)" visibleItems="20"
                                placeholder="Select ICD-10 Code Description"
                                [(ngModel)]="billingCode.diagnosisCode.diagnosisDescription">
                                <option *ngFor="let option of filteredDiagnosis">
                                    {{ option}}
                                </option>
                            </select>
                        </c-col>
                    </span>
                </c-row>
            </div>
            <div style="float:right">
                <button cButton  color="info" variant="outline" size="sm" (click)="toggleEditServiceLine(null,null)">
                    <svg cIcon name="cilPlus"></svg>
                </button>
            </div>
            <div>
                <c-row>
                    <c-col>
                        <table cTable hover small>
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Code</th>
                                    <th scope="col">LineNote</th>
                                    <th scope="col">Unit</th>
                                    <th scope="col">Charge</th>
                                    <th scope="col"></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let serviceLine of billingCode.ServiceLines;index as i">
                                    <th scope="row">{{i+1}}</th>
                                    <td>{{serviceLine.cptCode.serviceCode +'.' + serviceLine.cptCode.modifier}}</td>
                                    <td></td>
                                    <td>{{serviceLine.cptCode.unit}}</td>
                                    <td>{{serviceLine.cptCode.charge}}</td>
                                    <td>
                                        <c-button-group aria-label="Button outlined group with nested dropdown"
                                            role="group">
                                            <button cButton color="info" variant="outline"
                                                (click)="toggleEditServiceLine(serviceLine,i)" size="sm">
                                                <svg cIcon name="cilPen"></svg>
                                            </button>
                                            <button cButton color="info" variant="outline"
                                                (click)="removeSergiceCode(i)" size="sm">
                                                <svg cIcon name="cilTrash"></svg>
                                            </button>
                                        </c-button-group>

                                    </td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td>
                                        Total : {{unitCount}}
                                    </td>
                                    <td>{{chargeCount}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </c-col>
                </c-row>
            </div>
        </c-card-body>
    </c-card>
</c-container>

<c-modal id="editServiceLine" *ngIf="selectedServiceLine" [visible]="editServiceLineVisibility" backdrop="static"
    size="lg">
    <c-modal-header>
        <h5 cModalTitle>Edit Service Code</h5>
        <button (click)="toggleEditServiceLine(null,null)" cButtonClose></button>
    </c-modal-header>
    <c-modal-body>
        <c-container fluid>
            <div class="mb-3">
                <label cLabel for="serviceCode">Service Code</label>
                <input cFormControl id="serviceCode" placeholder="Service Code"
                    [(ngModel)]="selectedServiceLine.cptCode.serviceCode" sizing="sm" />
            </div>
            <div class="mb-3">
                <label cLabel for="modifier">Email address</label>
                <input cFormControl id="modifier" placeholder="Modifier"
                    [(ngModel)]="selectedServiceLine.cptCode.modifier" sizing="sm" />
            </div>
            <div class="mb-3">
                <label cLabel for="lineNote">Example textarea</label>
                <textarea cFormControl id="lineNote" rows="1" sizing="sm"></textarea>
            </div>
            <div class="mb-3">
                <label cLabel for="unit">Unit</label>
                <input cFormControl id="unit" placeholder="unit" [(ngModel)]="selectedServiceLine.cptCode.unit"
                    sizing="sm" />
            </div>
            <div class="mb-3">
                <label cLabel for="charge">Charge</label>
                <input cFormControl id="charge" placeholder="Charge" [(ngModel)]="selectedServiceLine.cptCode.charge"
                    sizing="sm" />
            </div>
            <div class="col-12 text-center">
                <button cButton variant="outline" style="width: 10%;" (click)="saveServiceCode()">Save</button>
            </div>
        </c-container>
    </c-modal-body>
</c-modal>